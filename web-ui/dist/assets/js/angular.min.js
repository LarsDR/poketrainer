angular.module("poketrainer",["poketrainer.Module.Templates","Poketrainer.Module.SocketEventEmitter","Poketrainer.Service.Navigation","Poketrainer.Service.SocketEvent","Poketrainer.Service.Socket","Poketrainer.State.Abstracts","Poketrainer.State.Status","Poketrainer.State.Users","ui.router","ngMaterial","ngMessages"]).config(["$urlRouterProvider","$locationProvider","$urlMatcherFactoryProvider","$mdThemingProvider",function(e,t,r,a){e.rule(function(e,t){var r=t.url().toLowerCase();if(!("/"===r[r.length-1]||r.indexOf("/?")>-1))return r.indexOf("?")>-1?r.replace("?","/?"):r+"/"}).otherwise("/"),r.strictMode(!1),a.theme("default").primaryPalette("blue").accentPalette("red")}]).run(["$state","$rootScope",function(e,t){t.$on("inventory:updated",function(e){})}]),angular.module("Poketrainer.Module.SocketEventEmitter",["Poketrainer.Service.Socket"]).run(["$rootScope","PokeSocket","SocketEvent",function(e,t,r){t.forward(r.UserStatus),t.on(r.Data,function(t){e.$broadcast(t.event+":"+t.action,t.data)})}]),angular.module("Poketrainer.State.Abstracts",["ui.router"]).config(["$stateProvider",function(e){e.state("public",{"abstract":!0,views:{header:{templateUrl:"states/abstracts/header.tpl.html",controller:"HeaderController"},content:{template:"<ui-view/>"}}})}]).controller("HeaderController",["$rootScope","$scope","$state","Navigation",function(e,t,r,a){t.navigation=a.primary.get(),t.state=r.current.name,e.$on("$stateChangeSuccess",function(e,r,a,n,o){t.state=r.name})}]),angular.module("Poketrainer.State.Status",["ui.router","uiGmapgoogle-maps","chart.js","easypiechart","datatables","ui-leaflet","nemLogging"]).config(["$stateProvider","uiGmapGoogleMapApiProvider",function(e,t){t.configure({v:"3.24",libraries:"weather,geometry,visualization"}),e.state("public.dashboard",{url:"/dashboard/:username",resolve:{locationData:["$q","$stateParams","PokeSocket","SocketEvent",function(e,t,r,a){var n=e.defer(),o=function(e){!angular.isUndefined(e)&&e.success&&"location"==e.type&&n.resolve(angular.fromJson(e.data))};return r.on(a.Request,o),r.emit(a.Request,{username:t.username,types:["location"]}),n.promise}],inventoryData:["$q","$stateParams","PokeSocket","SocketEvent",function(e,t,r,a){var n=e.defer(),o=function(e){!angular.isUndefined(e)&&e.success&&"inventory"==e.type&&n.resolve(angular.fromJson(e.data))};return r.on(a.Request,o),r.emit(a.Request,{username:t.username,types:["inventory"]}),n.promise}],playerData:["$q","$stateParams","PokeSocket","SocketEvent",function(e,t,r,a){var n=e.defer(),o=function(e){!angular.isUndefined(e)&&e.success&&"player"==e.type&&n.resolve(angular.fromJson(e.data))};return r.on(a.Request,o),r.emit(a.Request,{username:t.username,types:["player"]}),n.promise}],playerStatsData:["$q","$stateParams","PokeSocket","SocketEvent",function(e,t,r,a){var n=e.defer(),o=function(e){!angular.isUndefined(e)&&e.success&&"player_stats"==e.type&&n.resolve(angular.fromJson(e.data))};return r.on(a.Request,o),r.emit(a.Request,{username:t.username,types:["player_stats"]}),n.promise}],pokemonData:["$q","$stateParams","PokeSocket","SocketEvent",function(e,t,r,a){var n=e.defer(),o=function(e){!angular.isUndefined(e)&&e.success&&"pokemon"==e.type&&n.resolve(angular.fromJson(e.data))};return r.on(a.Request,o),r.emit(a.Request,{username:t.username,types:["pokemon"]}),n.promise}],attacksData:["$q","$stateParams","PokeSocket","SocketEvent",function(e,t,r,a){var n=e.defer(),o=function(e){!angular.isUndefined(e)&&e.success&&"attacks"==e.type&&n.resolve(angular.fromJson(e.data))};return r.on(a.Request,o),r.emit(a.Request,{username:t.username,types:["attacks"]}),n.promise}]},controller:"DashboardController",templateUrl:"states/dashboard/dashboard.tpl.html"})}]).run(["Navigation",function(e){e.primary.register("Users","public.users",30,"md md-event-available","public.users")}]).controller("DashboardController",["$scope","$stateParams","$mdToast","PokeSocket","leafletData","locationData","inventoryData","playerData","playerStatsData","pokemonData","attacksData","SocketEvent","DTOptionsBuilder",function(e,t,r,a,n,o,s,i,l,u,c,p,m){a.emit(p.Join,{room:t.username});var d,f=function S(t){if(e.transfer_disabled=!1,t.success)for(var n=e.pokemon.length-1;n>=0;n--)e.pokemon[n].id==d&&e.pokemon.splice(n,1);d=0,a.removeListener(p.Transfer,S),r.show(r.simple().textContent(t.message).position("top center").hideDelay(1e3))};e.transfer_disabled=!1,e.transfer=function(r){d=r,e.transfer_disabled=!0,a.on(p.Transfer,f),a.emit(p.Transfer,{username:t.username,p_id:r})};var v=function y(t){e.snipe_disabled=!1,a.removeListener(p.Snipe,y),r.show(r.simple().textContent(t.message).position("top center").hideDelay(1e3))};e.snipe_coords="",e.snipe_disabled=!1,e.snipe_auto=!1,e.snipe=function(r){e.snipe_disabled=!0,a.on(p.Snipe,v),a.emit(p.Snipe,{username:t.username,latlng:r})},e.$on("inventory:updated",function(t,r){e.inventory=r,g()}),e.$on("player_stats:updated",function(t,r){e.playerStats=r,g()}),e.$on("player:updated",function(t,r){e.player=r,g()}),e.$on("pokemon:caught",function(t,a){var n=a;e.pokemon.push(n),g(),r.show(r.simple().textContent("Caught: "+n.name+" (IV: "+Math.floor(n.iv)+" | CP: "+n.cp+")").position("top center").hideDelay(3e3))}),e.$on("pokemon:released",function(t,a){for(var n=a,o=e.pokemon.length-1;o>=0;o--)e.pokemon[o].id==n.id&&e.pokemon.splice(o,1);g(),r.show(r.simple().textContent("Released: "+n.name+" (IV: "+Math.floor(n.iv)+" | CP: "+n.cp+")").position("top center").hideDelay(3e3))}),e.$on("fort:spun",function(e,t){r.show(r.simple().textContent("Fort spun, reward: "+t.reward).position("top center").hideDelay(3e3))});var k=0;e.$on("position:update",function(t,r){if(k++,k%5==0){e.markers.bot.lat=r[0],e.markers.bot.lng=r[1];var a={lat:r[0],lng:r[1]};e.paths.main.latlngs.push(a)}}),e.player=i,e.playerStats=l,e.inventory=s,e.pokemon=u,e.attacks=c;var g=function(){e.playerStats.xpPercent=Math.floor((e.playerStats.experience-e.playerStats.prev_level_xp)/(e.playerStats.next_level_xp-e.playerStats.prev_level_xp)*100),e.playerStats.uniquePokedexPercent=Math.floor(e.playerStats.unique_pokedex_entries/151*100),e.playerStats.pokemonInvPercent=Math.floor(e.pokemon.length/e.player.max_pokemon_storage*100),e.playerStats.itemsInvPercent=Math.floor(e.inventory.item_count/e.player.max_item_storage*100)};g(),e.$on("$viewContentLoaded",function(){n.getMap().then(function(e){setTimeout(function(){e.invalidateSize()},3e3)})}),e.map={center:{lat:o[0],lng:o[1],zoom:15}},e.markers={bot:{lat:o[0],lng:o[1],message:e.player.username,focus:!0,draggable:!1}},e.paths={main:{color:"#F44336",weight:4,latlngs:[{lat:o[0],lng:o[1]}]}},e.pokemonDataTableOptions=m.newOptions().withOption("order",[[0,"desc"]]),e.expLvlOptions={animate:{duration:1e3,enabled:!0},barColor:"#03A9F4",scaleColor:!1,lineWidth:10,lineCap:"circle"},e.uniquePokedexOptions={animate:{duration:1e3,enabled:!0},barColor:"#FFC107",scaleColor:!1,lineWidth:10,lineCap:"circle"},e.pokemonInvOptions={animate:{duration:1e3,enabled:!0},barColor:"#009688",scaleColor:!1,lineWidth:10,lineCap:"circle"},e.itemsInvOptions={animate:{duration:1e3,enabled:!0},barColor:"#F44336",scaleColor:!1,lineWidth:10,lineCap:"circle"}}]),angular.module("Poketrainer.State.Users",["ui.router"]).config(["$stateProvider",function(e){e.state("public.users",{url:"/",resolve:{Users:["$q","$stateParams","PokeSocket","SocketEvent",function(e,t,r,a){var n=e.defer(),o=function s(e){!angular.isUndefined(e)&&e.success&&angular.isArray(e.users)&&(r.removeListener(a.UserList,s),n.resolve(e.users))};return r.on(a.UserList,o),r.emit(a.UserList),n.promise}]},controller:"UsersController",templateUrl:"states/users/users.tpl.html"})}]).run(["Navigation",function(e){e.primary.register("Users","public.users",30,"md md-event-available","public.users")}]).controller("UsersController",["$scope","Users","PokeSocket","SocketEvent",function(e,t,r,a){e.users=t;var n=function(t,r){for(var a=0;a<e.users.length;a++)e.users[a].username==r.username&&(e.users[a].status=r.status)};e.$on(a._prefix+a.UserStatus,n)}]),angular.module("Poketrainer.Service.Navigation",[]).factory("Navigation",function(){var e=[],t=function(){return e.sort(function(e,t){var r=e.Priority-t.Priority;return 0===r?e.Label.localeCompare(t.Label):r})},r=function(t,r,a,n,o){"string"!=typeof n&&(n="md md-chevron-right"),"string"!=typeof o&&(o=r),("number"!=typeof a||a<0)&&(a=10),e.push({Label:t,State:r,ActiveState:o,Priority:a,Icon:n})};return{primary:{get:t,register:r}}}),angular.module("Poketrainer.Service.SocketEvent",[]).factory("SocketEvent",function(){return{_prefix:"socket:",UserList:"users",UserStatus:"user_status",Request:"pull",Data:"push",Join:"join",Transfer:"transfer",Snipe:"snipe"}}),angular.module("Poketrainer.Service.Socket",["btford.socket-io"]).factory("PokeSocket",["socketFactory","$location",function(e,t){var r=window.location.pathname.replace(/\/+$/g,"")+"/socket.io";return e({ioSocket:io.connect(window.location.protocol+"//"+window.location.host+"/poketrainer",{path:r})})}]);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5qcyIsIm1vZHVsZXMvbW9kdWxlLlNvY2tldEV2ZW50RW1pdHRlci5qcyIsInN0YXRlcy9hYnN0cmFjdHMvc3RhdGUuYWJzdHJhY3RzLmpzIiwic3RhdGVzL2Rhc2hib2FyZC9zdGF0ZS5kYXNoYm9hcmQuanMiLCJzdGF0ZXMvdXNlcnMvc3RhdGUudXNlcnMuanMiLCJtb2R1bGVzL3NlcnZpY2VzL3NlcnZpY2UuTmF2aWdhdGlvbi5qcyJdLCJuYW1lcyI6WyJhbmd1bGFyIiwibW9kdWxlIiwiY29uZmlnIiwiJHVybFJvdXRlclByb3ZpZGVyIiwiJGxvY2F0aW9uUHJvdmlkZXIiLCIkdXJsTWF0Y2hlckZhY3RvcnlQcm92aWRlciIsIiRtZFRoZW1pbmdQcm92aWRlciIsInJ1bGUiLCIkaW5qZWN0b3IiLCIkbG9jYXRpb24iLCJwYXRoIiwidXJsIiwidG9Mb3dlckNhc2UiLCJsZW5ndGgiLCJpbmRleE9mIiwicmVwbGFjZSIsIm90aGVyd2lzZSIsInN0cmljdE1vZGUiLCJ0aGVtZSIsInByaW1hcnlQYWxldHRlIiwiYWNjZW50UGFsZXR0ZSIsInJ1biIsIiRzdGF0ZSIsIiRyb290U2NvcGUiLCIkb24iLCJkYXRhIiwiUG9rZVNvY2tldCIsIlNvY2tldEV2ZW50IiwiZm9yd2FyZCIsIlVzZXJTdGF0dXMiLCJvbiIsIkRhdGEiLCIkYnJvYWRjYXN0IiwiZXZlbnQiLCJhY3Rpb24iLCIkc3RhdGVQcm92aWRlciIsInN0YXRlIiwiYWJzdHJhY3QiLCJ2aWV3cyIsImhlYWRlciIsInRlbXBsYXRlVXJsIiwiY29udHJvbGxlciIsImNvbnRlbnQiLCJ0ZW1wbGF0ZSIsIiRzY29wZSIsIk5hdmlnYXRpb24iLCJuYXZpZ2F0aW9uIiwicHJpbWFyeSIsImdldCIsImN1cnJlbnQiLCJuYW1lIiwidG9TdGF0ZSIsInRvUGFyYW1zIiwiZnJvbVN0YXRlIiwiZnJvbVBhcmFtcyIsInVpR21hcEdvb2dsZU1hcEFwaVByb3ZpZGVyIiwiY29uZmlndXJlIiwidiIsImxpYnJhcmllcyIsInJlc29sdmUiLCJsb2NhdGlvbkRhdGEiLCIkcSIsIiRzdGF0ZVBhcmFtcyIsImQiLCJkZWZlciIsImxvY2F0aW9uRGF0YUNiIiwibWVzc2FnZSIsImlzVW5kZWZpbmVkIiwic3VjY2VzcyIsInR5cGUiLCJmcm9tSnNvbiIsIlJlcXVlc3QiLCJlbWl0IiwidXNlcm5hbWUiLCJ0eXBlcyIsInByb21pc2UiLCJpbnZlbnRvcnlEYXRhIiwiaW52ZW50b3J5RGF0YUNiIiwicGxheWVyRGF0YSIsInBsYXllckRhdGFDYiIsInBsYXllclN0YXRzRGF0YSIsInBsYXllclN0YXRzRGF0YUNiIiwicG9rZW1vbkRhdGEiLCJwb2tlbW9uRGF0YUNiIiwiYXR0YWNrc0RhdGEiLCJhdHRhY2tzRGF0YUNiIiwicmVnaXN0ZXIiLCIkbWRUb2FzdCIsImxlYWZsZXREYXRhIiwiRFRPcHRpb25zQnVpbGRlciIsIkpvaW4iLCJyb29tIiwidHJhbnNmZXJfcF9pZCIsInRyYW5zZmVyQ2IiLCJ0cmFuc2Zlcl9kaXNhYmxlZCIsImkiLCJwb2tlbW9uIiwiaWQiLCJzcGxpY2UiLCJyZW1vdmVMaXN0ZW5lciIsIlRyYW5zZmVyIiwic2hvdyIsInNpbXBsZSIsInRleHRDb250ZW50IiwicG9zaXRpb24iLCJoaWRlRGVsYXkiLCJ0cmFuc2ZlciIsInBfaWQiLCJzbmlwZWRDYiIsInNuaXBlX2Rpc2FibGVkIiwiU25pcGUiLCJzbmlwZV9jb29yZHMiLCJzbmlwZV9hdXRvIiwic25pcGUiLCJsYXRsbmciLCJpbnZlbnRvcnkiLCJ1cGRhdGVQZXJjZW50YWdlcyIsInBsYXllclN0YXRzIiwicGxheWVyIiwicHVzaCIsIk1hdGgiLCJmbG9vciIsIml2IiwiY3AiLCJyZXdhcmQiLCJwb3NpdGlvblVwZGF0ZXMiLCJtYXJrZXJzIiwiYm90IiwibGF0IiwibG5nIiwibmV3TG9jYXRpb24iLCJwYXRocyIsIm1haW4iLCJsYXRsbmdzIiwiYXR0YWNrcyIsInhwUGVyY2VudCIsImV4cGVyaWVuY2UiLCJwcmV2X2xldmVsX3hwIiwibmV4dF9sZXZlbF94cCIsInVuaXF1ZVBva2VkZXhQZXJjZW50IiwidW5pcXVlX3Bva2VkZXhfZW50cmllcyIsInBva2Vtb25JbnZQZXJjZW50IiwibWF4X3Bva2Vtb25fc3RvcmFnZSIsIml0ZW1zSW52UGVyY2VudCIsIml0ZW1fY291bnQiLCJtYXhfaXRlbV9zdG9yYWdlIiwiZ2V0TWFwIiwidGhlbiIsIm1hcCIsInNldFRpbWVvdXQiLCJpbnZhbGlkYXRlU2l6ZSIsImNlbnRlciIsInpvb20iLCJmb2N1cyIsImRyYWdnYWJsZSIsImNvbG9yIiwid2VpZ2h0IiwicG9rZW1vbkRhdGFUYWJsZU9wdGlvbnMiLCJuZXdPcHRpb25zIiwid2l0aE9wdGlvbiIsImV4cEx2bE9wdGlvbnMiLCJhbmltYXRlIiwiZHVyYXRpb24iLCJlbmFibGVkIiwiYmFyQ29sb3IiLCJzY2FsZUNvbG9yIiwibGluZVdpZHRoIiwibGluZUNhcCIsInVuaXF1ZVBva2VkZXhPcHRpb25zIiwicG9rZW1vbkludk9wdGlvbnMiLCJpdGVtc0ludk9wdGlvbnMiLCJVc2VycyIsInVzZXJFdmVudENiIiwiaXNBcnJheSIsInVzZXJzIiwiVXNlckxpc3QiLCJ1c2VyRXZlbnRVcGRhdGUiLCJzdGF0dXMiLCJfcHJlZml4IiwiZmFjdG9yeSIsImhlYWRlck5hdiIsImdldFByaW1hcnlNZW51Iiwic29ydCIsImEiLCJiIiwicHJpb3JpdHkiLCJQcmlvcml0eSIsIkxhYmVsIiwibG9jYWxlQ29tcGFyZSIsInJlZ2lzdGVyUHJpbWFyeU1lbnUiLCJsYWJlbCIsImljb24iLCJhY3RpdmVTdGF0ZSIsIlN0YXRlIiwiQWN0aXZlU3RhdGUiLCJJY29uIiwic29ja2V0RmFjdG9yeSIsIndpbmRvdyIsImxvY2F0aW9uIiwicGF0aG5hbWUiLCJpb1NvY2tldCIsImlvIiwiY29ubmVjdCIsInByb3RvY29sIiwiaG9zdCJdLCJtYXBwaW5ncyI6IkFBQUFBLFFBQUFDLE9BQUEsZUFDQSwrQkFDQSx3Q0FDQSxpQ0FDQSxrQ0FDQSw2QkFDQSw4QkFDQSwyQkFDQSww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TUFBQUMsY0FBQUosRUFBQUcsT0FFQUYsS0FHQUksRUFBQSxTQUFBQyxFQUFBMUosRUFBQXFKLEVBQUFNLEVBQUFDLEdBQ0EsZ0JBQUFELEtBQ0FBLEVBQUEsdUJBRUEsZ0JBQUFDLEtBQ0FBLEVBQUE1SixJQUVBLGdCQUFBcUosSUFBQUEsRUFBQSxLQUNBQSxFQUFBLElBRUFMLEVBQUE3RCxNQUNBb0UsTUFBQUcsRUFDQUcsTUFBQTdKLEVBQ0E4SixZQUFBRixFQUNBTixTQUFBRCxFQUNBVSxLQUFBSixJQ3ZEQSxRQUNBaEosU0FDQUMsSUFBQXFJLEVBQ0EvRixTQUFBdUcsTUFJQTdMLFFBQUFDLE9BQUEsc0NBQUFrTCxRQUFBLGNBQUEsV0FDQSxPQUNBRCxRQUFBLFVBQ0FILFNBQUEsUUFDQWxKLFdBQUEsY0FDQTBDLFFBQUEsT0FDQXhDLEtBQUEsT0FDQTJELEtBQUEsT0FDQVUsU0FBQSxXQUNBVSxNQUFBLFdBR0E5RyxRQUFBQyxPQUFBLDhCQUFBLHFCQUFBa0wsUUFBQSxjQUNBLGdCQUNBLFlBQ0EsU0FBQWlCLEVBQUEzTCxHQUNBLEdBQUFDLEdBQUEyTCxPQUFBQyxTQUFBQyxTQUFBeEwsUUFBQSxRQUFBLElBQUEsWUFFQSxPQUFBcUwsSUFBQUksU0FBQUMsR0FBQUMsUUFBQUwsT0FBQUMsU0FBQUssU0FBQSxLQUFBTixPQUFBQyxTQUFBTSxLQUFBLGdCQUFBbE0sS0FBQUEiLCJmaWxlIjoiYW5ndWxhci5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyJhbmd1bGFyLm1vZHVsZSgncG9rZXRyYWluZXInLCBbXG5cdCdwb2tldHJhaW5lci5Nb2R1bGUuVGVtcGxhdGVzJyxcblxuXHQvKiogSW50ZXJuYWwgTW9kdWxlcyAqKi9cblx0J1Bva2V0cmFpbmVyLk1vZHVsZS5Tb2NrZXRFdmVudEVtaXR0ZXInLFxuXG5cdC8qKiBJbnRlcm5hbCBTZXJ2aWNlcyAqKi9cblx0J1Bva2V0cmFpbmVyLlNlcnZpY2UuTmF2aWdhdGlvbicsXG5cdCdQb2tldHJhaW5lci5TZXJ2aWNlLlNvY2tldEV2ZW50Jyxcblx0J1Bva2V0cmFpbmVyLlNlcnZpY2UuU29ja2V0JyxcblxuXHQvKiogU3RhdGVzL1JvdXRlcyAqKi9cblx0J1Bva2V0cmFpbmVyLlN0YXRlLkFic3RyYWN0cycsXG5cdCdQb2tldHJhaW5lci5TdGF0ZS5TdGF0dXMnLFxuXHQnUG9rZXRyYWluZXIuU3RhdGUuVXNlcnMnLFxuXG5cblx0LyoqIEV4dGVybmFsIExpYnMgKiovXG5cdCd1aS5yb3V0ZXInLFxuICAgICduZ01hdGVyaWFsJyxcbiAgICAnbmdNZXNzYWdlcydcblxuXHQvKiogSW50ZXJuYWwgRGlyZWN0aXZlcyAqKi9cblx0XG5dKVxuXG5cdC5jb25maWcoZnVuY3Rpb24gcG9rZVRyYWluZXJDb25maWcoJHVybFJvdXRlclByb3ZpZGVyLCAkbG9jYXRpb25Qcm92aWRlciwgJHVybE1hdGNoZXJGYWN0b3J5UHJvdmlkZXIsICRtZFRoZW1pbmdQcm92aWRlcikge1xuXHRcdC8vJGxvY2F0aW9uUHJvdmlkZXJcblx0XHQvL1x0Lmhhc2hQcmVmaXgoJyEnKVxuXHRcdC8vXHQuaHRtbDVNb2RlKGZhbHNlKTtcblxuXHRcdCR1cmxSb3V0ZXJQcm92aWRlci5ydWxlKGZ1bmN0aW9uICgkaW5qZWN0b3IsICRsb2NhdGlvbikge1xuXHRcdFx0dmFyIHBhdGggPSAkbG9jYXRpb24udXJsKCkudG9Mb3dlckNhc2UoKTtcblxuXHRcdFx0Ly8gY2hlY2sgdG8gc2VlIGlmIHRoZSBwYXRoIGFscmVhZHkgaGFzIGEgc2xhc2ggd2hlcmUgaXQgc2hvdWxkIGJlXG5cdFx0XHRpZiAocGF0aFtwYXRoLmxlbmd0aCAtIDFdID09PSAnLycgfHwgcGF0aC5pbmRleE9mKCcvPycpID4gLTEpIHtcblx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAocGF0aC5pbmRleE9mKCc/JykgPiAtMSkge1xuXHRcdFx0XHRyZXR1cm4gcGF0aC5yZXBsYWNlKCc/JywgJy8/Jyk7XG5cdFx0XHR9XG5cblx0XHRcdHJldHVybiBwYXRoICsgJy8nO1xuXHRcdH0pXG5cdFx0Lm90aGVyd2lzZSgnLycpO1xuXG5cdFx0JHVybE1hdGNoZXJGYWN0b3J5UHJvdmlkZXIuc3RyaWN0TW9kZShmYWxzZSk7XG5cbiAgICAgICAgJG1kVGhlbWluZ1Byb3ZpZGVyLnRoZW1lKCdkZWZhdWx0JylcbiAgICAgICAgICAgIC5wcmltYXJ5UGFsZXR0ZSgnYmx1ZScpXG4gICAgICAgICAgICAuYWNjZW50UGFsZXR0ZSgncmVkJyk7XG5cblx0fSlcblxuXHQucnVuKGZ1bmN0aW9uIHBva2VUcmFpbmVyUnVuICgkc3RhdGUsICRyb290U2NvcGUpIHtcblx0XHQkcm9vdFNjb3BlLiRvbignaW52ZW50b3J5OnVwZGF0ZWQnLCBmdW5jdGlvbihkYXRhKXtcblx0XHRcdC8vY29uc29sZS5sb2coXCJJbnZlbnRvcnkhISA6RCBcIilcblx0XHR9KVxuXHR9KVxuXG47IiwiYW5ndWxhci5tb2R1bGUoJ1Bva2V0cmFpbmVyLk1vZHVsZS5Tb2NrZXRFdmVudEVtaXR0ZXInLCBbJ1Bva2V0cmFpbmVyLlNlcnZpY2UuU29ja2V0J10pXG4gICAgLnJ1bihmdW5jdGlvbiBydW5Tb2NrZXRFbWl0dGVyKCRyb290U2NvcGUsIFBva2VTb2NrZXQsIFNvY2tldEV2ZW50KXtcblxuICAgICAgICBQb2tlU29ja2V0LmZvcndhcmQoU29ja2V0RXZlbnQuVXNlclN0YXR1cyk7XG5cbiAgICAgICAgUG9rZVNvY2tldC5vbihTb2NrZXRFdmVudC5EYXRhLCBmdW5jdGlvbiBnZXRTb2NrZXRQdXNoKGRhdGEpe1xuICAgICAgICAgICAgLy9jb25zb2xlLmxvZyhcIkdvdCBwdXNoIGRhdGE6IFwiLCBkYXRhKTtcbiAgICAgICAgICAgICRyb290U2NvcGUuJGJyb2FkY2FzdChkYXRhLmV2ZW50ICsgXCI6XCIgKyBkYXRhLmFjdGlvbiwgZGF0YS5kYXRhKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gQnJvYWRjYXN0IGV2ZW50cyB1c2luZyAkcm9vdFNjb3BlLiRicm9hZGNhc3QoW25hbWVdLCBbZGF0YV0pO1xuICAgIH0pXG5cbjsiLCJhbmd1bGFyLm1vZHVsZSgnUG9rZXRyYWluZXIuU3RhdGUuQWJzdHJhY3RzJywgW1xuICAgICd1aS5yb3V0ZXInXG5dKVxuXG4gICAgLmNvbmZpZyhmdW5jdGlvbiBjb25maWcoJHN0YXRlUHJvdmlkZXIpIHtcbiAgICAgICAgJHN0YXRlUHJvdmlkZXJcbiAgICAgICAgICAgIC5zdGF0ZSgncHVibGljJywge1xuICAgICAgICAgICAgICAgIGFic3RyYWN0OiB0cnVlLFxuICAgICAgICAgICAgICAgIHZpZXdzOiB7XG4gICAgICAgICAgICAgICAgICAgIFwiaGVhZGVyXCI6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnc3RhdGVzL2Fic3RyYWN0cy9oZWFkZXIudHBsLmh0bWwnLFxuICAgICAgICAgICAgICAgICAgICAgICAgY29udHJvbGxlcjogJ0hlYWRlckNvbnRyb2xsZXInXG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIFwiY29udGVudFwiOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0ZW1wbGF0ZTogJzx1aS12aWV3Lz4nXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KVxuICAgICAgICA7XG4gICAgfSlcblxuICAgIC5jb250cm9sbGVyKCdIZWFkZXJDb250cm9sbGVyJywgZnVuY3Rpb24gSGVhZGVyQ29udHJvbGxlcigkcm9vdFNjb3BlLCAkc2NvcGUsICRzdGF0ZSwgTmF2aWdhdGlvbil7XG4gICAgICAgICRzY29wZS5uYXZpZ2F0aW9uID0gTmF2aWdhdGlvbi5wcmltYXJ5LmdldCgpO1xuICAgICAgICAkc2NvcGUuc3RhdGUgPSAkc3RhdGUuY3VycmVudC5uYW1lO1xuXG4gICAgICAgICRyb290U2NvcGUuJG9uKCckc3RhdGVDaGFuZ2VTdWNjZXNzJywgZnVuY3Rpb24gKGV2ZW50LCB0b1N0YXRlLCB0b1BhcmFtcywgZnJvbVN0YXRlLCBmcm9tUGFyYW1zKSB7XG4gICAgICAgICAgICAkc2NvcGUuc3RhdGUgPSB0b1N0YXRlLm5hbWU7XG4gICAgICAgIH0pO1xuICAgIH0pXG5cbjsiLCJhbmd1bGFyLm1vZHVsZSgnUG9rZXRyYWluZXIuU3RhdGUuU3RhdHVzJywgW1xyXG4gICAgJ3VpLnJvdXRlcicsXHJcbiAgICAndWlHbWFwZ29vZ2xlLW1hcHMnLFxyXG4gICAgJ2NoYXJ0LmpzJyxcclxuICAgICdlYXN5cGllY2hhcnQnLFxyXG4gICAgJ2RhdGF0YWJsZXMnLFxyXG4gICAgJ3VpLWxlYWZsZXQnLFxyXG4gICAgJ25lbUxvZ2dpbmcnXHJcbl0pXHJcblxyXG4gICAgLmNvbmZpZyhmdW5jdGlvbiBjb25maWcoJHN0YXRlUHJvdmlkZXIsIHVpR21hcEdvb2dsZU1hcEFwaVByb3ZpZGVyKSB7XHJcblxyXG4gICAgICAgIHVpR21hcEdvb2dsZU1hcEFwaVByb3ZpZGVyLmNvbmZpZ3VyZSh7XHJcbiAgICAgICAgICAgIC8va2V5OiAnPE1BUFMgQVBJIEtFWT4nLFxyXG4gICAgICAgICAgICB2OiAnMy4yNCcsXHJcbiAgICAgICAgICAgIGxpYnJhcmllczogJ3dlYXRoZXIsZ2VvbWV0cnksdmlzdWFsaXphdGlvbidcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgJHN0YXRlUHJvdmlkZXIuc3RhdGUoJ3B1YmxpYy5kYXNoYm9hcmQnLCB7XHJcbiAgICAgICAgICAgIHVybDogJy9kYXNoYm9hcmQvOnVzZXJuYW1lJyxcclxuICAgICAgICAgICAgcmVzb2x2ZToge1xyXG4gICAgICAgICAgICAgICAgbG9jYXRpb25EYXRhOiBbJyRxJywgJyRzdGF0ZVBhcmFtcycsICdQb2tlU29ja2V0JywgJ1NvY2tldEV2ZW50JywgZnVuY3Rpb24gcmVzb2x2ZUxvY2F0aW9uRGF0YSgkcSwgJHN0YXRlUGFyYW1zLCBQb2tlU29ja2V0LCBTb2NrZXRFdmVudCl7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGQgPSAkcS5kZWZlcigpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICB2YXIgbG9jYXRpb25EYXRhQ2IgPSBmdW5jdGlvbiBsb2NhdGlvbkRhdGFDYihtZXNzYWdlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmKGFuZ3VsYXIuaXNVbmRlZmluZWQobWVzc2FnZSkgfHwgIW1lc3NhZ2Uuc3VjY2VzcyB8fCBtZXNzYWdlLnR5cGUgIT0gJ2xvY2F0aW9uJyl7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgZC5yZXNvbHZlKGFuZ3VsYXIuZnJvbUpzb24obWVzc2FnZS5kYXRhKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgUG9rZVNvY2tldC5vbihTb2NrZXRFdmVudC5SZXF1ZXN0LCBsb2NhdGlvbkRhdGFDYik7XHJcbiAgICAgICAgICAgICAgICAgICAgUG9rZVNvY2tldC5lbWl0KFNvY2tldEV2ZW50LlJlcXVlc3QsIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdXNlcm5hbWU6ICRzdGF0ZVBhcmFtcy51c2VybmFtZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgdHlwZXM6IFsnbG9jYXRpb24nXVxyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZC5wcm9taXNlO1xyXG4gICAgICAgICAgICAgICAgfV0sXHJcbiAgICAgICAgICAgICAgICBpbnZlbnRvcnlEYXRhOiBbJyRxJywgJyRzdGF0ZVBhcmFtcycsICdQb2tlU29ja2V0JywgJ1NvY2tldEV2ZW50JywgZnVuY3Rpb24gcmVzb2x2ZUludmVudG9yeURhdGEoJHEsICRzdGF0ZVBhcmFtcywgUG9rZVNvY2tldCwgU29ja2V0RXZlbnQpe1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBkID0gJHEuZGVmZXIoKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGludmVudG9yeURhdGFDYiA9IGZ1bmN0aW9uIGludmVudG9yeURhdGFDYihtZXNzYWdlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmKGFuZ3VsYXIuaXNVbmRlZmluZWQobWVzc2FnZSkgfHwgIW1lc3NhZ2Uuc3VjY2VzcyB8fCBtZXNzYWdlLnR5cGUgIT0gJ2ludmVudG9yeScpe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGQucmVzb2x2ZShhbmd1bGFyLmZyb21Kc29uKG1lc3NhZ2UuZGF0YSkpO1xyXG4gICAgICAgICAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIFBva2VTb2NrZXQub24oU29ja2V0RXZlbnQuUmVxdWVzdCwgaW52ZW50b3J5RGF0YUNiKTtcclxuICAgICAgICAgICAgICAgICAgICBQb2tlU29ja2V0LmVtaXQoU29ja2V0RXZlbnQuUmVxdWVzdCwge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB1c2VybmFtZTogJHN0YXRlUGFyYW1zLnVzZXJuYW1lLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB0eXBlczogWydpbnZlbnRvcnknXVxyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZC5wcm9taXNlO1xyXG4gICAgICAgICAgICAgICAgfV0sXHJcbiAgICAgICAgICAgICAgICBwbGF5ZXJEYXRhOiBbJyRxJywgJyRzdGF0ZVBhcmFtcycsICdQb2tlU29ja2V0JywgJ1NvY2tldEV2ZW50JywgZnVuY3Rpb24gcmVzb2x2ZVBsYXllckRhdGEoJHEsICRzdGF0ZVBhcmFtcywgUG9rZVNvY2tldCwgU29ja2V0RXZlbnQpe1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBkID0gJHEuZGVmZXIoKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHBsYXllckRhdGFDYiA9IGZ1bmN0aW9uIHBsYXllckRhdGFDYihtZXNzYWdlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmKGFuZ3VsYXIuaXNVbmRlZmluZWQobWVzc2FnZSkgfHwgIW1lc3NhZ2Uuc3VjY2VzcyB8fCBtZXNzYWdlLnR5cGUgIT0gJ3BsYXllcicpe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGQucmVzb2x2ZShhbmd1bGFyLmZyb21Kc29uKG1lc3NhZ2UuZGF0YSkpO1xyXG4gICAgICAgICAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIFBva2VTb2NrZXQub24oU29ja2V0RXZlbnQuUmVxdWVzdCwgcGxheWVyRGF0YUNiKTtcclxuICAgICAgICAgICAgICAgICAgICBQb2tlU29ja2V0LmVtaXQoU29ja2V0RXZlbnQuUmVxdWVzdCwge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB1c2VybmFtZTogJHN0YXRlUGFyYW1zLnVzZXJuYW1lLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB0eXBlczogWydwbGF5ZXInXVxyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZC5wcm9taXNlO1xyXG4gICAgICAgICAgICAgICAgfV0sXHJcbiAgICAgICAgICAgICAgICBwbGF5ZXJTdGF0c0RhdGE6IFsnJHEnLCAnJHN0YXRlUGFyYW1zJywgJ1Bva2VTb2NrZXQnLCAnU29ja2V0RXZlbnQnLCBmdW5jdGlvbiByZXNvbHZlUGxheWVyU3RhdHNEYXRhKCRxLCAkc3RhdGVQYXJhbXMsIFBva2VTb2NrZXQsIFNvY2tldEV2ZW50KXtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgZCA9ICRxLmRlZmVyKCk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHZhciBwbGF5ZXJTdGF0c0RhdGFDYiA9IGZ1bmN0aW9uIHBsYXllclN0YXRzRGF0YUNiKG1lc3NhZ2UpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYoYW5ndWxhci5pc1VuZGVmaW5lZChtZXNzYWdlKSB8fCAhbWVzc2FnZS5zdWNjZXNzIHx8IG1lc3NhZ2UudHlwZSAhPSAncGxheWVyX3N0YXRzJyl7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgZC5yZXNvbHZlKGFuZ3VsYXIuZnJvbUpzb24obWVzc2FnZS5kYXRhKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgUG9rZVNvY2tldC5vbihTb2NrZXRFdmVudC5SZXF1ZXN0LCBwbGF5ZXJTdGF0c0RhdGFDYik7XHJcbiAgICAgICAgICAgICAgICAgICAgUG9rZVNvY2tldC5lbWl0KFNvY2tldEV2ZW50LlJlcXVlc3QsIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdXNlcm5hbWU6ICRzdGF0ZVBhcmFtcy51c2VybmFtZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgdHlwZXM6IFsncGxheWVyX3N0YXRzJ11cclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGQucHJvbWlzZTtcclxuICAgICAgICAgICAgICAgIH1dLFxyXG4gICAgICAgICAgICAgICAgcG9rZW1vbkRhdGE6IFsnJHEnLCAnJHN0YXRlUGFyYW1zJywgJ1Bva2VTb2NrZXQnLCAnU29ja2V0RXZlbnQnLCBmdW5jdGlvbiByZXNvbHZlUG9rZW1vbkRhdGEoJHEsICRzdGF0ZVBhcmFtcywgUG9rZVNvY2tldCwgU29ja2V0RXZlbnQpe1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBkID0gJHEuZGVmZXIoKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHBva2Vtb25EYXRhQ2IgPSBmdW5jdGlvbiBwb2tlbW9uRGF0YUNiKG1lc3NhZ2UpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYoYW5ndWxhci5pc1VuZGVmaW5lZChtZXNzYWdlKSB8fCAhbWVzc2FnZS5zdWNjZXNzIHx8IG1lc3NhZ2UudHlwZSAhPSAncG9rZW1vbicpe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGQucmVzb2x2ZShhbmd1bGFyLmZyb21Kc29uKG1lc3NhZ2UuZGF0YSkpO1xyXG4gICAgICAgICAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIFBva2VTb2NrZXQub24oU29ja2V0RXZlbnQuUmVxdWVzdCwgcG9rZW1vbkRhdGFDYik7XHJcbiAgICAgICAgICAgICAgICAgICAgUG9rZVNvY2tldC5lbWl0KFNvY2tldEV2ZW50LlJlcXVlc3QsIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdXNlcm5hbWU6ICRzdGF0ZVBhcmFtcy51c2VybmFtZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgdHlwZXM6IFsncG9rZW1vbiddXHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBkLnByb21pc2U7XHJcbiAgICAgICAgICAgICAgICB9XSxcclxuICAgICAgICAgICAgICAgIGF0dGFja3NEYXRhOiBbJyRxJywgJyRzdGF0ZVBhcmFtcycsICdQb2tlU29ja2V0JywgJ1NvY2tldEV2ZW50JywgZnVuY3Rpb24gcmVzb2x2ZUF0dGFja3NEYXRhKCRxLCAkc3RhdGVQYXJhbXMsIFBva2VTb2NrZXQsIFNvY2tldEV2ZW50KXtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgZCA9ICRxLmRlZmVyKCk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHZhciBhdHRhY2tzRGF0YUNiID0gZnVuY3Rpb24gYXR0YWNrc0RhdGFDYihtZXNzYWdlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmKGFuZ3VsYXIuaXNVbmRlZmluZWQobWVzc2FnZSkgfHwgIW1lc3NhZ2Uuc3VjY2VzcyB8fCBtZXNzYWdlLnR5cGUgIT0gJ2F0dGFja3MnKXtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBkLnJlc29sdmUoYW5ndWxhci5mcm9tSnNvbihtZXNzYWdlLmRhdGEpKTtcclxuICAgICAgICAgICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBQb2tlU29ja2V0Lm9uKFNvY2tldEV2ZW50LlJlcXVlc3QsIGF0dGFja3NEYXRhQ2IpO1xyXG4gICAgICAgICAgICAgICAgICAgIFBva2VTb2NrZXQuZW1pdChTb2NrZXRFdmVudC5SZXF1ZXN0LCB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHVzZXJuYW1lOiAkc3RhdGVQYXJhbXMudXNlcm5hbWUsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGVzOiBbJ2F0dGFja3MnXVxyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZC5wcm9taXNlO1xyXG4gICAgICAgICAgICAgICAgfV1cclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgY29udHJvbGxlcjogJ0Rhc2hib2FyZENvbnRyb2xsZXInLFxyXG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ3N0YXRlcy9kYXNoYm9hcmQvZGFzaGJvYXJkLnRwbC5odG1sJ1xyXG4gICAgICAgIH0pXHJcbiAgICAgICAgO1xyXG4gICAgfSlcclxuXHJcbiAgICAucnVuKGZ1bmN0aW9uIChOYXZpZ2F0aW9uKSB7XHJcbiAgICAgICAgTmF2aWdhdGlvbi5wcmltYXJ5LnJlZ2lzdGVyKFwiVXNlcnNcIiwgXCJwdWJsaWMudXNlcnNcIiwgMzAsICdtZCBtZC1ldmVudC1hdmFpbGFibGUnLCAncHVibGljLnVzZXJzJyk7XHJcbiAgICB9KVxyXG5cclxuICAgIC5jb250cm9sbGVyKCdEYXNoYm9hcmRDb250cm9sbGVyJywgZnVuY3Rpb24gRGFzaGJvYXJkQ29udHJvbGxlcigkc2NvcGUsICRzdGF0ZVBhcmFtcywgJG1kVG9hc3QsIFBva2VTb2NrZXQsIGxlYWZsZXREYXRhLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2F0aW9uRGF0YSwgaW52ZW50b3J5RGF0YSwgcGxheWVyRGF0YSwgcGxheWVyU3RhdHNEYXRhLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBva2Vtb25EYXRhLCBhdHRhY2tzRGF0YSwgU29ja2V0RXZlbnQsIERUT3B0aW9uc0J1aWxkZXIpIHtcclxuXHJcbiAgICAgICAgLy8gSm9pbiBzcGVjaWZpYyB1c2VyIHJvb21cclxuICAgICAgICAvLyBUT0RPOiB3ZSBzaG91bGQgbGVhdmUgdGhlIHJvb20gd2hlbiB3ZSBjaGFuZ2UgdGhlIHBhZ2VcclxuICAgICAgICBQb2tlU29ja2V0LmVtaXQoU29ja2V0RXZlbnQuSm9pbiwge3Jvb206ICRzdGF0ZVBhcmFtcy51c2VybmFtZX0pO1xyXG4gICAgICAgIC8vY29uc29sZS5sb2coXCJKb2luZWQhIFwiLCBTb2NrZXRFdmVudC5Kb2luLCAkc3RhdGVQYXJhbXMudXNlcm5hbWUpO1xyXG5cclxuICAgICAgICB2YXIgdHJhbnNmZXJfcF9pZDtcclxuICAgICAgICB2YXIgdHJhbnNmZXJDYiA9IGZ1bmN0aW9uIHRyYW5zZmVyQ2IobWVzc2FnZSkge1xyXG4gICAgICAgICAgICAvL21lc3NhZ2Uuc3VjY2VzcztcclxuICAgICAgICAgICAgJHNjb3BlLnRyYW5zZmVyX2Rpc2FibGVkID0gZmFsc2U7XHJcbiAgICAgICAgICAgIGlmIChtZXNzYWdlLnN1Y2Nlc3MpIHtcclxuICAgICAgICAgICAgICAgIGZvcih2YXIgaT0kc2NvcGUucG9rZW1vbi5sZW5ndGgtMTsgaT49MDsgaS0tKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCRzY29wZS5wb2tlbW9uW2ldLmlkID09IHRyYW5zZmVyX3BfaWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnBva2Vtb24uc3BsaWNlKGksMSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHRyYW5zZmVyX3BfaWQgPSAwO1xyXG4gICAgICAgICAgICBQb2tlU29ja2V0LnJlbW92ZUxpc3RlbmVyKFNvY2tldEV2ZW50LlRyYW5zZmVyLCB0cmFuc2ZlckNiKTtcclxuICAgICAgICAgICAgJG1kVG9hc3Quc2hvdyhcclxuICAgICAgICAgICAgICAgICRtZFRvYXN0LnNpbXBsZSgpXHJcbiAgICAgICAgICAgICAgICAgICAgLnRleHRDb250ZW50KG1lc3NhZ2UubWVzc2FnZSlcclxuICAgICAgICAgICAgICAgICAgICAucG9zaXRpb24oJ3RvcCBjZW50ZXInKVxyXG4gICAgICAgICAgICAgICAgICAgIC5oaWRlRGVsYXkoMTAwMClcclxuICAgICAgICAgICAgKTtcclxuICAgICAgICB9O1xyXG4gICAgICAgICRzY29wZS50cmFuc2Zlcl9kaXNhYmxlZCA9IGZhbHNlO1xyXG4gICAgICAgICRzY29wZS50cmFuc2ZlciA9IGZ1bmN0aW9uKHBfaWQpIHtcclxuICAgICAgICAgICAgdHJhbnNmZXJfcF9pZCA9IHBfaWQ7XHJcbiAgICAgICAgICAgICRzY29wZS50cmFuc2Zlcl9kaXNhYmxlZCA9IHRydWU7XHJcbiAgICAgICAgICAgIFBva2VTb2NrZXQub24oU29ja2V0RXZlbnQuVHJhbnNmZXIsIHRyYW5zZmVyQ2IpO1xyXG4gICAgICAgICAgICBQb2tlU29ja2V0LmVtaXQoU29ja2V0RXZlbnQuVHJhbnNmZXIsIHt1c2VybmFtZTogJHN0YXRlUGFyYW1zLnVzZXJuYW1lLCBwX2lkOiBwX2lkfSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIHNuaXBlZENiID0gZnVuY3Rpb24gc25pcGVkQ2IobWVzc2FnZSkge1xyXG4gICAgICAgICAgICAvL21lc3NhZ2Uuc3VjY2VzcztcclxuICAgICAgICAgICAgJHNjb3BlLnNuaXBlX2Rpc2FibGVkID0gZmFsc2U7XHJcbiAgICAgICAgICAgIFBva2VTb2NrZXQucmVtb3ZlTGlzdGVuZXIoU29ja2V0RXZlbnQuU25pcGUsIHNuaXBlZENiKTtcclxuICAgICAgICAgICAgJG1kVG9hc3Quc2hvdyhcclxuICAgICAgICAgICAgICAgICRtZFRvYXN0LnNpbXBsZSgpXHJcbiAgICAgICAgICAgICAgICAgICAgLnRleHRDb250ZW50KG1lc3NhZ2UubWVzc2FnZSlcclxuICAgICAgICAgICAgICAgICAgICAucG9zaXRpb24oJ3RvcCBjZW50ZXInKVxyXG4gICAgICAgICAgICAgICAgICAgIC5oaWRlRGVsYXkoMTAwMClcclxuICAgICAgICAgICAgKTtcclxuICAgICAgICB9O1xyXG4gICAgICAgICRzY29wZS5zbmlwZV9jb29yZHMgPSAnJztcclxuICAgICAgICAkc2NvcGUuc25pcGVfZGlzYWJsZWQgPSBmYWxzZTtcclxuICAgICAgICAkc2NvcGUuc25pcGVfYXV0byA9IGZhbHNlOyAvLyBub3QgaW1wbGVtZW50ZWRcclxuICAgICAgICAkc2NvcGUuc25pcGUgPSBmdW5jdGlvbihzbmlwZV9jb29yZHMpIHtcclxuICAgICAgICAgICAgJHNjb3BlLnNuaXBlX2Rpc2FibGVkID0gdHJ1ZTtcclxuICAgICAgICAgICAgUG9rZVNvY2tldC5vbihTb2NrZXRFdmVudC5TbmlwZSwgc25pcGVkQ2IpO1xyXG4gICAgICAgICAgICBQb2tlU29ja2V0LmVtaXQoU29ja2V0RXZlbnQuU25pcGUsIHt1c2VybmFtZTogJHN0YXRlUGFyYW1zLnVzZXJuYW1lLCBsYXRsbmc6IHNuaXBlX2Nvb3Jkc30pO1xyXG4gICAgICAgIH07XHJcbiAgICAgICAgXHJcbiAgICAgICAgJHNjb3BlLiRvbignaW52ZW50b3J5OnVwZGF0ZWQnLCBmdW5jdGlvbihldmVudCwgZGF0YSkgeyBcclxuIMKgIMKgIMKgIMKgIMKgIMKgJHNjb3BlLmludmVudG9yeSA9IGRhdGE7XHJcbiAgICAgICAgICAgIHVwZGF0ZVBlcmNlbnRhZ2VzKCk7XHJcbiDCoCDCoCDCoCDCoH0pO1xyXG5cclxuICAgICAgICAkc2NvcGUuJG9uKCdwbGF5ZXJfc3RhdHM6dXBkYXRlZCcsIGZ1bmN0aW9uKGV2ZW50LCBkYXRhKSB7XHJcbiDCoCDCoCDCoCDCoCDCoCDCoCRzY29wZS5wbGF5ZXJTdGF0cyA9IGRhdGE7XHJcbiAgICAgICAgICAgIHVwZGF0ZVBlcmNlbnRhZ2VzKCk7XHJcbiDCoCDCoCDCoCDCoH0pO1xyXG5cclxuICAgICAgICAkc2NvcGUuJG9uKCdwbGF5ZXI6dXBkYXRlZCcsIGZ1bmN0aW9uKGV2ZW50LCBkYXRhKSB7XHJcbiDCoCDCoCDCoCDCoCDCoCDCoCRzY29wZS5wbGF5ZXIgPSBkYXRhO1xyXG4gICAgICAgICAgICB1cGRhdGVQZXJjZW50YWdlcygpO1xyXG4gwqAgwqAgwqAgwqB9KTtcclxuXHJcbiAgICAgICAgLy8gdGhpcyBtYWtlcyB0aGUgcG9rZW1vbiB0YWJsZSBnbyBjcmF6eSBmb3IgYSBiaXRcclxuICAgICAgICAvLyB3ZSBpbnNlcnQgLyBkZWxldGUgYmFzZWQgb24gb3RoZXIgZXZlbnMsIHNvIGl0IF9zaG91bGRfIGJlIGFjY3VyYXRlIGFueXdheVxyXG4gICAgICAgIC8qJHNjb3BlLiRvbignY2F1Z2h0X3Bva2Vtb246dXBkYXRlZCcsIGZ1bmN0aW9uKGV2ZW50LCBkYXRhKSB7XHJcbiAgICAgICAgICAgICRzY29wZS5wb2tlbW9uID0gZGF0YTtcclxuIMKgIMKgIMKgIMKgfSk7Ki9cclxuIFxyXG4gICAgICAgICRzY29wZS4kb24oJ3Bva2Vtb246Y2F1Z2h0JywgZnVuY3Rpb24oZXZlbnQsIGRhdGEpIHtcclxuICAgICAgICAgICAgdmFyIHBva2Vtb24gPSBkYXRhO1xyXG4gICAgICAgICAgICAvL3Bva2Vtb24uY3JlYXRpb25fdGltZV9tcyA9IG5ldyBEYXRlKCkuZ2V0VGltZSgpO1xyXG4gwqAgwqAgwqAgwqAgwqAgwqAkc2NvcGUucG9rZW1vbi5wdXNoKHBva2Vtb24pO1xyXG4gICAgICAgICAgICB1cGRhdGVQZXJjZW50YWdlcygpO1xyXG4gICAgICAgICAgICAkbWRUb2FzdC5zaG93KFxyXG4gICAgICAgICAgICAgICAgJG1kVG9hc3Quc2ltcGxlKClcclxuICAgICAgICAgICAgICAgICAgICAudGV4dENvbnRlbnQoJ0NhdWdodDogJyArIHBva2Vtb24ubmFtZSArICcgKElWOiAnICsgTWF0aC5mbG9vcihwb2tlbW9uLml2KSArICcgfCBDUDogJyArIHBva2Vtb24uY3AgKyAnKScpXHJcbiAgICAgICAgICAgICAgICAgICAgLnBvc2l0aW9uKCd0b3AgY2VudGVyJylcclxuICAgICAgICAgICAgICAgICAgICAuaGlkZURlbGF5KDMwMDApXHJcbiAgICAgICAgICAgICk7XHJcbiDCoCDCoCDCoCDCoH0pO1xyXG5cclxuICAgICAgICAkc2NvcGUuJG9uKCdwb2tlbW9uOnJlbGVhc2VkJywgZnVuY3Rpb24oZXZlbnQsIGRhdGEpIHtcclxuICAgICAgICAgICAgdmFyIHBva2Vtb24gPSBkYXRhO1xyXG4gICAgICAgICAgICBmb3IodmFyIGk9JHNjb3BlLnBva2Vtb24ubGVuZ3RoLTE7IGk+PTA7IGktLSkge1xyXG4gICAgICAgICAgICAgICAgaWYgKCRzY29wZS5wb2tlbW9uW2ldLmlkID09IHBva2Vtb24uaWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUucG9rZW1vbi5zcGxpY2UoaSwxKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB1cGRhdGVQZXJjZW50YWdlcygpO1xyXG4gICAgICAgICAgICAkbWRUb2FzdC5zaG93KFxyXG4gICAgICAgICAgICAgICAgJG1kVG9hc3Quc2ltcGxlKClcclxuICAgICAgICAgICAgICAgICAgICAudGV4dENvbnRlbnQoJ1JlbGVhc2VkOiAnICsgcG9rZW1vbi5uYW1lICsgJyAoSVY6ICcgKyBNYXRoLmZsb29yKHBva2Vtb24uaXYpICsgJyB8IENQOiAnICsgcG9rZW1vbi5jcCArICcpJylcclxuICAgICAgICAgICAgICAgICAgICAucG9zaXRpb24oJ3RvcCBjZW50ZXInKVxyXG4gICAgICAgICAgICAgICAgICAgIC5oaWRlRGVsYXkoMzAwMClcclxuICAgICAgICAgICAgKTtcclxuIMKgIMKgIMKgIMKgfSk7XHJcblxyXG4gICAgICAgICRzY29wZS4kb24oJ2ZvcnQ6c3B1bicsIGZ1bmN0aW9uKGV2ZW50LCBkYXRhKSB7XHJcbiAgICAgICAgICAgICRtZFRvYXN0LnNob3coXHJcbiAgICAgICAgICAgICAgICAkbWRUb2FzdC5zaW1wbGUoKVxyXG4gICAgICAgICAgICAgICAgICAgIC50ZXh0Q29udGVudCgnRm9ydCBzcHVuLCByZXdhcmQ6ICcgKyBkYXRhLnJld2FyZClcclxuICAgICAgICAgICAgICAgICAgICAucG9zaXRpb24oJ3RvcCBjZW50ZXInKVxyXG4gICAgICAgICAgICAgICAgICAgIC5oaWRlRGVsYXkoMzAwMClcclxuICAgICAgICAgICAgKTtcclxuIMKgIMKgIMKgIMKgfSk7XHJcbiBcclxuICAgICAgICB2YXIgcG9zaXRpb25VcGRhdGVzID0gMDtcclxuIMKgIMKgIMKgIMKgJHNjb3BlLiRvbigncG9zaXRpb246dXBkYXRlJywgZnVuY3Rpb24oZXZlbnQsIGRhdGEpIHtcclxuIMKgIMKgIMKgIMKgIMKgIMKgcG9zaXRpb25VcGRhdGVzKys7XHJcbiDCoCDCoCDCoCDCoCDCoCDCoGlmIChwb3NpdGlvblVwZGF0ZXMgJSA1ID09IDApIHtcclxuIMKgIMKgIMKgIMKgIMKgIMKgIMKgIMKgJHNjb3BlLm1hcmtlcnMuYm90LmxhdCA9IGRhdGFbMF07XHJcbiDCoCDCoCDCoCDCoCDCoCDCoCDCoCDCoCRzY29wZS5tYXJrZXJzLmJvdC5sbmcgPSBkYXRhWzFdO1xyXG4gwqAgwqAgwqAgwqAgwqAgwqAgwqAgwqB2YXIgbmV3TG9jYXRpb24gPSB7bGF0OiBkYXRhWzBdLCBsbmc6IGRhdGFbMV19O1xyXG4gwqAgwqAgwqAgwqAgwqAgwqAgwqAgwqAkc2NvcGUucGF0aHMubWFpbi5sYXRsbmdzLnB1c2gobmV3TG9jYXRpb24pO1xyXG4gwqAgwqAgwqAgwqAgwqAgwqB9XHJcbiDCoCDCoCDCoCDCoH0pO1xyXG5cclxuICAgICAgICAkc2NvcGUucGxheWVyID0gcGxheWVyRGF0YTtcclxuICAgICAgICAkc2NvcGUucGxheWVyU3RhdHMgPSBwbGF5ZXJTdGF0c0RhdGE7XHJcbiAgICAgICAgJHNjb3BlLmludmVudG9yeSA9IGludmVudG9yeURhdGE7XHJcbiAgICAgICAgJHNjb3BlLnBva2Vtb24gPSBwb2tlbW9uRGF0YTtcclxuICAgICAgICAkc2NvcGUuYXR0YWNrcyA9IGF0dGFja3NEYXRhO1xyXG5cclxuICAgICAgICB2YXIgdXBkYXRlUGVyY2VudGFnZXMgPSBmdW5jdGlvbiB1cGRhdGVQZXJjZW50YWdlcygpIHtcclxuICAgICAgICAgICAgJHNjb3BlLnBsYXllclN0YXRzLnhwUGVyY2VudCA9IE1hdGguZmxvb3IoXHJcbiAgICAgICAgICAgICAgICAoJHNjb3BlLnBsYXllclN0YXRzLmV4cGVyaWVuY2UgLSAkc2NvcGUucGxheWVyU3RhdHMucHJldl9sZXZlbF94cClcclxuICAgICAgICAgICAgICAgIC8oJHNjb3BlLnBsYXllclN0YXRzLm5leHRfbGV2ZWxfeHAgLSAkc2NvcGUucGxheWVyU3RhdHMucHJldl9sZXZlbF94cClcclxuICAgICAgICAgICAgICAgICoxMDBcclxuICAgICAgICAgICAgKTtcclxuICAgICAgICAgICAgJHNjb3BlLnBsYXllclN0YXRzLnVuaXF1ZVBva2VkZXhQZXJjZW50ID0gTWF0aC5mbG9vcigkc2NvcGUucGxheWVyU3RhdHMudW5pcXVlX3Bva2VkZXhfZW50cmllcyAvIDE1MSAqIDEwMCk7XHJcbiAgICAgICAgICAgICRzY29wZS5wbGF5ZXJTdGF0cy5wb2tlbW9uSW52UGVyY2VudCA9IE1hdGguZmxvb3IoJHNjb3BlLnBva2Vtb24ubGVuZ3RoIC8gJHNjb3BlLnBsYXllci5tYXhfcG9rZW1vbl9zdG9yYWdlICAqIDEwMCk7XHJcbiAgICAgICAgICAgICRzY29wZS5wbGF5ZXJTdGF0cy5pdGVtc0ludlBlcmNlbnQgPSBNYXRoLmZsb29yKCRzY29wZS5pbnZlbnRvcnkuaXRlbV9jb3VudCAvICRzY29wZS5wbGF5ZXIubWF4X2l0ZW1fc3RvcmFnZSAgKiAxMDApO1xyXG4gICAgICAgIH07XHJcbiAgICAgICAgdXBkYXRlUGVyY2VudGFnZXMoKTtcclxuXHJcbiAgICAgICAgLy8gdmVyeSBkaXJ0eSBmaXggdG8gbWFrZSB0aGUgbGVhZmxldCBtYXAgbG9hZCBmdWxsc2NyZWVuXHJcbiAgICAgICAgJHNjb3BlLiRvbignJHZpZXdDb250ZW50TG9hZGVkJywgZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIGxlYWZsZXREYXRhLmdldE1hcCgpLnRoZW4oZnVuY3Rpb24obWFwKSB7XHJcbiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7IG1hcC5pbnZhbGlkYXRlU2l6ZSgpOyB9LCAzMDAwKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgJHNjb3BlLm1hcCA9IHsgY2VudGVyOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYXQ6IGxvY2F0aW9uRGF0YVswXSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxuZzogbG9jYXRpb25EYXRhWzFdLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgem9vbTogMTVcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgIFxyXG4gICAgICAgICRzY29wZS5tYXJrZXJzID0ge1xyXG4gICAgICAgICAgICBib3Q6IHtcclxuICAgICAgICAgICAgICAgIGxhdDogbG9jYXRpb25EYXRhWzBdLFxyXG4gICAgICAgICAgICAgICAgbG5nOiBsb2NhdGlvbkRhdGFbMV0sXHJcbiAgICAgICAgICAgICAgICBtZXNzYWdlOiAkc2NvcGUucGxheWVyLnVzZXJuYW1lLFxyXG4gICAgICAgICAgICAgICAgZm9jdXM6IHRydWUsXHJcbiAgICAgICAgICAgICAgICBkcmFnZ2FibGU6IGZhbHNlXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG4gICAgICAgIFxyXG4gICAgICAgICRzY29wZS5wYXRocyA9IHtcclxuICAgICAgICAgICAgbWFpbjoge1xyXG4gICAgICAgICAgICAgICAgY29sb3I6ICcjRjQ0MzM2JyxcclxuICAgICAgICAgICAgICAgIHdlaWdodDogNCxcclxuICAgICAgICAgICAgICAgIGxhdGxuZ3M6IFtcclxuICAgICAgICAgICAgICAgICAgICB7IGxhdDogbG9jYXRpb25EYXRhWzBdLCBsbmc6IGxvY2F0aW9uRGF0YVsxXSB9XHJcbiAgICAgICAgICAgICAgICBdXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG4gICAgICAgIFxyXG4gICAgICAgICRzY29wZS5wb2tlbW9uRGF0YVRhYmxlT3B0aW9ucyA9IERUT3B0aW9uc0J1aWxkZXIubmV3T3B0aW9ucygpXHJcbiAgICAgICAgICAgIC53aXRoT3B0aW9uKCdvcmRlcicsIFtbIDAsIFwiZGVzY1wiIF1dKTtcclxuICAgICAgICAgICAgLyoud2l0aE9wdGlvbigncGFnaW5nJywgdHJ1ZSlcclxuICAgICAgICAgICAgLndpdGhPcHRpb24oJ3Njcm9sbFknLCAnNzV2aCcpXHJcbiAgICAgICAgICAgIC53aXRoT3B0aW9uKCdzY3JvbGxYJywgdHJ1ZSk7Ki9cclxuXHJcbiAgICAgICAgJHNjb3BlLmV4cEx2bE9wdGlvbnMgPSB7XHJcbiAgICAgICAgICAgIGFuaW1hdGU6e1xyXG4gICAgICAgICAgICAgICAgZHVyYXRpb246MTAwMCxcclxuICAgICAgICAgICAgICAgIGVuYWJsZWQ6dHJ1ZVxyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICBiYXJDb2xvcjonIzAzQTlGNCcsXHJcbiAgICAgICAgICAgIHNjYWxlQ29sb3I6ZmFsc2UsXHJcbiAgICAgICAgICAgIGxpbmVXaWR0aDoxMCxcclxuICAgICAgICAgICAgbGluZUNhcDonY2lyY2xlJ1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgICRzY29wZS51bmlxdWVQb2tlZGV4T3B0aW9ucyA9IHtcclxuICAgICAgICAgICAgYW5pbWF0ZTp7XHJcbiAgICAgICAgICAgICAgICBkdXJhdGlvbjoxMDAwLFxyXG4gICAgICAgICAgICAgICAgZW5hYmxlZDp0cnVlXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIGJhckNvbG9yOicjRkZDMTA3JyxcclxuICAgICAgICAgICAgc2NhbGVDb2xvcjpmYWxzZSxcclxuICAgICAgICAgICAgbGluZVdpZHRoOjEwLFxyXG4gICAgICAgICAgICBsaW5lQ2FwOidjaXJjbGUnXHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgJHNjb3BlLnBva2Vtb25JbnZPcHRpb25zID0ge1xyXG4gICAgICAgICAgICBhbmltYXRlOntcclxuICAgICAgICAgICAgICAgIGR1cmF0aW9uOjEwMDAsXHJcbiAgICAgICAgICAgICAgICBlbmFibGVkOnRydWVcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgYmFyQ29sb3I6JyMwMDk2ODgnLFxyXG4gICAgICAgICAgICBzY2FsZUNvbG9yOmZhbHNlLFxyXG4gICAgICAgICAgICBsaW5lV2lkdGg6MTAsXHJcbiAgICAgICAgICAgIGxpbmVDYXA6J2NpcmNsZSdcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICAkc2NvcGUuaXRlbXNJbnZPcHRpb25zID0ge1xyXG4gICAgICAgICAgICBhbmltYXRlOntcclxuICAgICAgICAgICAgICAgIGR1cmF0aW9uOjEwMDAsXHJcbiAgICAgICAgICAgICAgICBlbmFibGVkOnRydWVcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgYmFyQ29sb3I6JyNGNDQzMzYnLFxyXG4gICAgICAgICAgICBzY2FsZUNvbG9yOmZhbHNlLFxyXG4gICAgICAgICAgICBsaW5lV2lkdGg6MTAsXHJcbiAgICAgICAgICAgIGxpbmVDYXA6J2NpcmNsZSdcclxuICAgICAgICB9O1xyXG4gICAgICAgIFxyXG4gICAgICAgIFxyXG5cclxuICAgIH0pXHJcbjtcclxuIiwiYW5ndWxhci5tb2R1bGUoJ1Bva2V0cmFpbmVyLlN0YXRlLlVzZXJzJywgW1xuICAgICd1aS5yb3V0ZXInXG5dKVxuXG4gICAgLmNvbmZpZyhmdW5jdGlvbiBjb25maWcoJHN0YXRlUHJvdmlkZXIpIHtcbiAgICAgICAgJHN0YXRlUHJvdmlkZXIuc3RhdGUoJ3B1YmxpYy51c2VycycsIHtcbiAgICAgICAgICAgIHVybDogJy8nLFxuICAgICAgICAgICAgcmVzb2x2ZToge1xuICAgICAgICAgICAgICAgIFVzZXJzOiBbJyRxJywgJyRzdGF0ZVBhcmFtcycsICdQb2tlU29ja2V0JywgJ1NvY2tldEV2ZW50JywgZnVuY3Rpb24gcmVzb2x2ZVVzZXJzKCRxLCAkc3RhdGVQYXJhbXMsIFBva2VTb2NrZXQsIFNvY2tldEV2ZW50KXtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGQgPSAkcS5kZWZlcigpO1xuXG4gICAgICAgICAgICAgICAgICAgIHZhciB1c2VyRXZlbnRDYiA9IGZ1bmN0aW9uIHVzZXJFdmVudENiKG1lc3NhZ2UpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmKGFuZ3VsYXIuaXNVbmRlZmluZWQobWVzc2FnZSkgfHwgIW1lc3NhZ2Uuc3VjY2VzcyB8fCAhYW5ndWxhci5pc0FycmF5KG1lc3NhZ2UudXNlcnMpKXtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBQb2tlU29ja2V0LnJlbW92ZUxpc3RlbmVyKFNvY2tldEV2ZW50LlVzZXJMaXN0LCB1c2VyRXZlbnRDYik7XG4gICAgICAgICAgICAgICAgICAgICAgICBkLnJlc29sdmUobWVzc2FnZS51c2Vycyk7XG4gICAgICAgICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICAgICAgICAgUG9rZVNvY2tldC5vbihTb2NrZXRFdmVudC5Vc2VyTGlzdCwgdXNlckV2ZW50Q2IpO1xuXG4gICAgICAgICAgICAgICAgICAgIC8vIEVtaXQgdGhlIGV2ZW50IHRvIG91ciBzb2NrZXRcbiAgICAgICAgICAgICAgICAgICAgLy8gYWZ0ZXIgbGlzdGVuaW5nIGZvciBpdC5cbiAgICAgICAgICAgICAgICAgICAgLy8gd2UgZG9uJ3QgbmVlZCB0byBzaW5jZSB3ZSBjb25uZWN0IGFueXdheSwgYW55IGlzc3Vlcz9cbiAgICAgICAgICAgICAgICAgICAgLy8gd2UgZW5lZCBpdCB0byBnZXQgYmFjayB0byB0aGUgYm90cy1vdmVydmlldz9cbiAgICAgICAgICAgICAgICAgICAgUG9rZVNvY2tldC5lbWl0KFNvY2tldEV2ZW50LlVzZXJMaXN0KTtcblxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZC5wcm9taXNlO1xuICAgICAgICAgICAgICAgIH1dXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgY29udHJvbGxlcjogJ1VzZXJzQ29udHJvbGxlcicsXG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ3N0YXRlcy91c2Vycy91c2Vycy50cGwuaHRtbCdcbiAgICAgICAgfSlcbiAgICAgICAgO1xuICAgIH0pXG5cbiAgICAucnVuKGZ1bmN0aW9uIChOYXZpZ2F0aW9uKSB7XG4gICAgICAgIE5hdmlnYXRpb24ucHJpbWFyeS5yZWdpc3RlcihcIlVzZXJzXCIsIFwicHVibGljLnVzZXJzXCIsIDMwLCAnbWQgbWQtZXZlbnQtYXZhaWxhYmxlJywgJ3B1YmxpYy51c2VycycpO1xuICAgIH0pXG5cbiAgICAuY29udHJvbGxlcignVXNlcnNDb250cm9sbGVyJywgZnVuY3Rpb24gVXNlcnNDb250cm9sbGVyKCRzY29wZSwgVXNlcnMsIFBva2VTb2NrZXQsIFNvY2tldEV2ZW50KSB7XG4gICAgICAgIC8vIHdlIGRvbid0IG5lZWQgYW55IGRhdGEgZnJvbSB0aGUgZ2xvYmFsIHNjb3BlIGhlcmUuLi4geWV0P1xuICAgICAgICAvL1Bva2VTb2NrZXQuZW1pdChTb2NrZXRFdmVudC5Kb2luLCB7cm9vbTogJ2dsb2JhbCd9KTtcbiAgICAgICAgJHNjb3BlLnVzZXJzID0gVXNlcnM7XG5cbiAgICAgICAgdmFyIHVzZXJFdmVudFVwZGF0ZSA9IGZ1bmN0aW9uIHVzZXJFdmVudFVwZGF0ZShldmVudCwgbWVzc2FnZSkge1xuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCAkc2NvcGUudXNlcnMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICBpZiAoJHNjb3BlLnVzZXJzW2ldLnVzZXJuYW1lID09IG1lc3NhZ2UudXNlcm5hbWUpIHtcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnVzZXJzW2ldLnN0YXR1cyA9IG1lc3NhZ2Uuc3RhdHVzO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICAvLyBNYWtlIHN1cmUgdG8gbGlzdGVuIGZvciBuZXcgZXZlbnRzXG4gICAgICAgICRzY29wZS4kb24oU29ja2V0RXZlbnQuX3ByZWZpeCArIFNvY2tldEV2ZW50LlVzZXJTdGF0dXMsIHVzZXJFdmVudFVwZGF0ZSk7XG4gICAgfSlcbjtcbiIsImFuZ3VsYXIubW9kdWxlKCdQb2tldHJhaW5lci5TZXJ2aWNlLk5hdmlnYXRpb24nLCBbXSlcblxuICAgIC5mYWN0b3J5KCdOYXZpZ2F0aW9uJywgZnVuY3Rpb24gTmF2aWdhdGlvbkZhY3RvcnkoKSB7XG4gICAgICAgIHZhciBoZWFkZXJOYXYgPSBbXTtcblxuICAgICAgICB2YXIgZ2V0UHJpbWFyeU1lbnUgPSBmdW5jdGlvbiBnZXRQcmltYXJ5TWVudSgpIHtcbiAgICAgICAgICAgIHJldHVybiBoZWFkZXJOYXYuc29ydChmdW5jdGlvbiAoYSwgYikge1xuICAgICAgICAgICAgICAgIHZhciBwcmlvcml0eSA9IGEuUHJpb3JpdHkgLSBiLlByaW9yaXR5O1xuXG4gICAgICAgICAgICAgICAgaWYgKHByaW9yaXR5ID09PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBhLkxhYmVsLmxvY2FsZUNvbXBhcmUoYi5MYWJlbCk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgcmV0dXJuIHByaW9yaXR5O1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH07XG4gICAgICAgIHZhciByZWdpc3RlclByaW1hcnlNZW51ID0gZnVuY3Rpb24gcmVnaXN0ZXJQcmltYXJ5TWVudShsYWJlbCwgc3RhdGUsIHByaW9yaXR5LCBpY29uLCBhY3RpdmVTdGF0ZSkge1xuICAgICAgICAgICAgaWYoIHR5cGVvZihpY29uKSAhPT0gXCJzdHJpbmdcIil7XG4gICAgICAgICAgICAgICAgaWNvbiA9IFwibWQgbWQtY2hldnJvbi1yaWdodFwiO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYoIHR5cGVvZihhY3RpdmVTdGF0ZSkgIT09IFwic3RyaW5nXCIpe1xuICAgICAgICAgICAgICAgIGFjdGl2ZVN0YXRlID0gc3RhdGU7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmICh0eXBlb2YgKHByaW9yaXR5KSAhPT0gXCJudW1iZXJcIiB8fCBwcmlvcml0eSA8IDApIHtcbiAgICAgICAgICAgICAgICBwcmlvcml0eSA9IDEwO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBoZWFkZXJOYXYucHVzaCh7XG4gICAgICAgICAgICAgICAgTGFiZWw6IGxhYmVsLFxuICAgICAgICAgICAgICAgIFN0YXRlOiBzdGF0ZSxcbiAgICAgICAgICAgICAgICBBY3RpdmVTdGF0ZTogYWN0aXZlU3RhdGUsXG4gICAgICAgICAgICAgICAgUHJpb3JpdHk6IHByaW9yaXR5LFxuICAgICAgICAgICAgICAgIEljb246IGljb25cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuXG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBwcmltYXJ5OiB7XG4gICAgICAgICAgICAgICAgZ2V0OiBnZXRQcmltYXJ5TWVudSxcbiAgICAgICAgICAgICAgICByZWdpc3RlcjogcmVnaXN0ZXJQcmltYXJ5TWVudVxuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgIH0pOyJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==
